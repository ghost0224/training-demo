<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Training-UI</title>
    <script src="./js/angular.min.js"></script>
    <script src="./js/angular-route.min.js"></script>
    <script src="./js/jquery.min.js"></script>
    <script src="./js/common.js"></script>
</head>
<body ng-app='TrainingApp'>
    <h2>TrainingApp</h2>
    <ul>
        <li><a href="#!/">Index</a></li>
        <li><a href="#!/search">Search Trainings</a></li>
        <li><a href="#!/current">Current Trainings</a></li>
        <li><a href="#!/completed">Completed Trainings</a></li>
        <li><a href="#!/payment">Payment History</a></li>
        <li id="li-login" ng-if="null == loginUser"><a href="#!/login">Login</a></li>
        <li id="li-logout" style="display: none"><a href="#" ng-click="$scope.logout()">Logout</a></li>
    </ul>

    <div ng-view>Training System</div>
    <script>
        angular.module('TrainingApp',['ngRoute'])
            .controller('LoginController', function ($scope, $route, $http) {
                $scope.$route = $route;
                $scope.user = {};
                $scope.login = function () {
                    console.log($scope.user);
                    $http.post(baseUrl+'user/login', $scope.user)
                    .then(function (resp) {
                        console.log(resp);
                        if(resp.status == 200 && resp.data.status) {
                            window.location='#!/current';
                            loginUser = resp.data.data;
                            $("#li-login").hide();
                            $("#li-logout").show();
                        } else {
                            alert('login error!');
                        }
                    })
                };
                $scope.logout = function () {
                    console.log("logout");
                    $("#li-login").show();
                    $("#li-logout").hide();
                    window.location='#!/index';
                }
            })
            .controller('SearchController', function ($scope, $route, $http) {
                console.log(loginUser);
                $scope.searchDto = {};
                $scope.training = new Array();
                $scope.search = function () {
                    $scope.searchDto.title = $("#context").val();
                    console.log($scope.searchDto);
                    $http.post(baseUrl+'training/training/search', $scope.searchDto)
                        .then(function (resp) {
                            console.log(resp);
                            if(resp.status == 200 && resp.data.status) {
                                $scope.training = resp.data.data;
                            } else {
                                alert('search error!');
                            }
                        })
                }
                $scope.enroll = function () {
                    alert('enroll');
                }
            })
            .controller('CurrentController', function ($scope, $route, $http) {
                console.log(loginUser);
                $scope.userTraining = new Array();
                if(null != loginUser) {
                    $http.post(baseUrl+'training/training/findByUserId/'+loginUser.id)
                        .then(function (resp) {
                            console.log(resp);
                            if(resp.status == 200 && resp.data.status) {
                                $scope.userTraining = resp.data.data;
                            } else {
                                alert('find error!');
                            }
                        })
                }
            })
            .config(['$routeProvider', function($routeProvider){
                $routeProvider
                .when('/login',{
                    templateUrl:'./login.html',
                    controller: 'LoginController'
                })
                .when('/logout',
                    {redirectTo:'/index'}
                )
                .when('/current',{
                    templateUrl:'./current.html',
                    controller: 'CurrentController'
                })
                .when('/search',{
                    templateUrl:'./search.html',
                    controller: 'SearchController'
                })
                .otherwise({redirectTo:'/index'});
            }]);
    </script>

</body>
</html>